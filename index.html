<!DOCTYPE html>
<html>
<head>
    <title>Remote Access</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #0a0a0a; 
            color: #00ff00;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        #screen {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
        }
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            border-top: 1px solid #00ff00;
        }
        .btn {
            background: #002200;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }
        .btn:active {
            background: #004400;
        }
        .status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 5px 10px;
            border: 1px solid #00ff00;
            font-size: 12px;
        }
        .connection-established {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,255,0,0.2);
            padding: 20px;
            border: 2px solid #00ff00;
            text-align: center;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- NO PASSWORD PROTECTION - DIRECT ACCESS -->
    <div class="status" id="status">SYSTEM: INITIALIZING REMOTE ACCESS...</div>
    <div class="connection-established" id="connectionMsg" style="display: none;">
        REMOTE CONNECTION ESTABLISHED<br>
        STREAMING ACTIVE
    </div>
    <div id="screenContainer">
        <img id="screen" src="" alt="Remote Screen">
    </div>
    
    <div class="controls">
        <button class="btn" onclick="sendKey('Enter')">ENTER</button>
        <button class="btn" onclick="sendKey('Escape')">ESC</button>
        <button class="btn" onclick="sendKey('Tab')">TAB</button>
        <button class="btn" onclick="sendKey('Space')">SPACE</button>
        <button class="btn" onclick="sendSpecial('CTRL_ALT_DEL')">CTRL+ALT+DEL</button>
        <button class="btn" onclick="sendSpecial('ALT_TAB')">ALT+TAB</button>
        <button class="btn" onclick="sendSpecial('WIN')">WIN</button>
        <button class="btn" onclick="sendSpecial('CTRL_C')">CTRL+C</button>
        <button class="btn" onclick="sendSpecial('CTRL_V')">CTRL+V</button>
        <button class="btn" onclick="sendSpecial('CTRL_A')">CTRL+A</button>
        <button class="btn" onclick="sendSpecial('CTRL_S')">CTRL+S</button>
        <button class="btn" onclick="sendSpecial('SHUTDOWN')">SHUTDOWN</button>
        <button class="btn" onclick="sendSpecial('RESTART')">RESTART</button>
        <button class="btn" onclick="sendSpecial('LOGOFF')">LOGOFF</button>
        <button class="btn" onclick="sendSpecial('TASKMGR')">TASK MGR</button>
    </div>

    <script>
        // Auto-connect without authentication
        let ws = null;
        let isConnected = false;
        const clientId = 'direct_access_' + Math.random().toString(36).substr(2, 16);
        const serverUrl = 'wss://your-app.netlify.app/.netlify/functions/ws';

        // Remove any existing password protection
        function removePasswordProtection() {
            // Remove password modal if exists
            const passwordOverlay = document.getElementById('passwordOverlay');
            const authDiv = document.getElementById('auth');
            const loginForm = document.querySelector('form');
            
            if (passwordOverlay) passwordOverlay.remove();
            if (authDiv) authDiv.remove();
            if (loginForm) loginForm.remove();
            
            // Clear any password storage
            localStorage.removeItem('password');
            sessionStorage.removeItem('auth');
            document.cookie = "auth=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            
            // Override any password checks
            window.authenticate = function() { return true; };
            window.checkPassword = function() { return true; };
            window.verifyAuth = function() { return true; };
        }

        function initializeConnection() {
            removePasswordProtection();
            
            try {
                ws = new WebSocket(serverUrl);
                
                ws.onopen = function() {
                    isConnected = true;
                    document.getElementById('status').textContent = 'CONNECTED - REMOTE CONTROL ACTIVE';
                    document.getElementById('status').style.color = '#00ff00';
                    document.getElementById('connectionMsg').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('connectionMsg').style.display = 'none';
                    }, 3000);
                    
                    // Start screen streaming immediately
                    startScreenStream();
                    startInputHandling();
                };

                ws.onmessage = function(event) {
                    if (typeof event.data === 'string') {
                        const data = JSON.parse(event.data);
                        processServerMessage(data);
                    } else {
                        // Handle binary screen data
                        displayScreenData(event.data);
                    }
                };

                ws.onclose = function() {
                    isConnected = false;
                    document.getElementById('status').textContent = 'RECONNECTING...';
                    document.getElementById('status').style.color = '#ff0000';
                    setTimeout(initializeConnection, 2000);
                };

                ws.onerror = function(error) {
                    console.log('Connection error, retrying...');
                    setTimeout(initializeConnection, 3000);
                };

            } catch (error) {
                console.log('Initialization error, retrying...');
                setTimeout(initializeConnection, 3000);
            }
        }

        function processServerMessage(data) {
            switch(data.type) {
                case 'SCREEN_UPDATE':
                    // Screen updates handled in binary
                    break;
                case 'SYSTEM_INFO':
                    console.log('System info:', data.info);
                    break;
                case 'COMMAND_RESULT':
                    console.log('Command executed:', data.result);
                    break;
            }
        }

        function displayScreenData(binaryData) {
            const blob = new Blob([binaryData], {type: 'image/jpeg'});
            const url = URL.createObjectURL(blob);
            const screenImg = document.getElementById('screen');
            screenImg.src = url;
            screenImg.onload = () => URL.revokeObjectURL(url);
        }

        function startScreenStream() {
            // Request screen updates every 100ms
            setInterval(() => {
                if (isConnected && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'REQUEST_SCREEN',
                        clientId: clientId,
                        quality: 80,
                        width: window.screen.width,
                        height: window.screen.height
                    }));
                }
            }, 100);
        }

        function startInputHandling() {
            const screen = document.getElementById('screen');
            
            screen.addEventListener('mousedown', handleMouseEvent);
            screen.addEventListener('mousemove', handleMouseEvent);
            screen.addEventListener('mouseup', handleMouseEvent);
            screen.addEventListener('click', handleMouseEvent);
            screen.addEventListener('dblclick', handleMouseEvent);
            screen.addEventListener('contextmenu', (e) => e.preventDefault());
            
            // Touch support for mobile
            screen.addEventListener('touchstart', handleTouchEvent, {passive: false});
            screen.addEventListener('touchmove', handleTouchEvent, {passive: false});
            screen.addEventListener('touchend', handleTouchEvent, {passive: false});
        }

        function handleMouseEvent(e) {
            if (!isConnected) return;
            
            const rect = e.target.getBoundingClientRect();
            const x = Math.round((e.clientX - rect.left) * (1920 / rect.width));
            const y = Math.round((e.clientY - rect.top) * (1080 / rect.height));
            
            ws.send(JSON.stringify({
                type: 'MOUSE_EVENT',
                clientId: clientId,
                event: e.type,
                x: x,
                y: y,
                button: e.button
            }));
            
            e.preventDefault();
        }

        function handleTouchEvent(e) {
            if (!isConnected) return;
            
            const rect = e.target.getBoundingClientRect();
            const touch = e.touches[0] || e.changedTouches[0];
            const x = Math.round((touch.clientX - rect.left) * (1920 / rect.width));
            const y = Math.round((touch.clientY - rect.top) * (1080 / rect.height));
            
            ws.send(JSON.stringify({
                type: 'TOUCH_EVENT',
                clientId: clientId,
                event: e.type,
                x: x,
                y: y
            }));
            
            e.preventDefault();
        }

        function sendKey(key) {
            if (!isConnected) return;
            
            ws.send(JSON.stringify({
                type: 'KEY_EVENT',
                clientId: clientId,
                key: key,
                action: 'press'
            }));
        }

        function sendSpecial(command) {
            if (!isConnected) return;
            
            ws.send(JSON.stringify({
                type: 'SPECIAL_COMMAND',
                clientId: clientId,
                command: command
            }));
        }

        // Auto-start everything on page load
        window.addEventListener('load', function() {
            // Remove any password protection immediately
            removePasswordProtection();
            
            // Start connection
            initializeConnection();
            
            // Force remove any auth elements every second for 5 seconds
            const cleanupInterval = setInterval(removePasswordProtection, 100);
            setTimeout(() => clearInterval(cleanupInterval), 5000);
        });

        // Prevent any context menus
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

    </script>
</body>
</html>
